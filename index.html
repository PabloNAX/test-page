<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting</title>
<!--     <script type="text/javascript">
        window.location.href = "https://uify.me/Login?flowId=sUfZtY9zZlDG5EP&flowToken=sNXvoXOVf3A6w7GEZeMNDJ";
    </script> -->
<!--     <script type="text/javascript">
        window.onload = function() {
            console.log("Page loaded");
            var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            console.log("Is mobile device: " + isMobile);
            if (isMobile) {
                var now = new Date().valueOf();
                setTimeout(function() {
                    if (new Date().valueOf() - now > 100) {
                        console.log("Stay on page");
                        return;
                    }
                    console.log("Redirecting to fallback URL");
                    window.location = 'https://pablonax.github.io/test-page/';
                }, 25);
                console.log("Attempting to open app");
                window.location = 'cbdno://'; 
            }
        };
    </script> -->

    <script type="text/javascript">
        window.onload = function() {
            console.log("Page loaded");

            // Parse flowId and flowToken from the current URL
            var urlParams = new URLSearchParams(window.location.search);
            var flowId = urlParams.get('flowId') || '';
            var flowToken = urlParams.get('flowToken') || '';

            console.log("Flow ID: " + flowId);
            console.log("Flow Token: " + flowToken);

            var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            console.log("Is mobile device: " + isMobile);
            if (isMobile) {
                var now = new Date().valueOf();
                setTimeout(function() {
                    if (new Date().valueOf() - now > 100) {
                        console.log("Stay on page");
                        return;
                    }
                    console.log("Redirecting to fallback URL");
                    // Redirect to the fallback URL with the parameters
                    // TODO do not forget to change url accordingly for SIT/UAT/PROD
                    window.location = 'https://ribuat.cbddev.ae/RIB_Portal_WEB/Login/?flowId=' + encodeURIComponent(flowId) + '&flowToken=' + encodeURIComponent(flowToken);
                }, 25);
                console.log("Attempting to open app");
                window.location = 'cbdnow://aani/authVerify/?flowId=' + encodeURIComponent(flowId) + '&flowToken=' + encodeURIComponent(flowToken)'; 
            } else {
                // Fallback if open link in the browser from the desktop
                // TODO Do not forget to change url accordingly for SIT/UAT/PROD
                window.location = 'https://ribuat.cbddev.ae/RIB_Portal_WEB/Login/?flowId=' + encodeURIComponent(flowId) + '&flowToken=' + encodeURIComponent(flowToken);
            }
        };
    </script>
</head>
<body>
    <p>If you are not redirected, <a href="https://https://ribuat.cbddev.ae/RIB_Portal_WEB/Login?flowId=sUfZtY9zZlDG5EP&flowToken=sNXvoXOVf3A6w7GEZeMNDJ">click here</a>.</p>
</body>
</html>
